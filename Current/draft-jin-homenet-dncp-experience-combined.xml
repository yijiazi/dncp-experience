<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>

<rfc ipr="trust200902"
category="info"
docName="draft-jin-homenet-dncp-experience-00">

<front>
<title abbrev="DNCP Experience">Experience with the Distributed Node Consensus Protocol (DNCP)</title>

<author fullname="Kaiwen Jin" initials="K.J." surname="Jin">
<organization>Ecole Polytechnique / Cisco</organization>
<address>
<postal>
<street></street>
<city></city>
<region></region>
<country>France</country>
</postal>
<phone></phone>
<email></email>
<uri></uri>
</address>

</author>

<author fullname="Pierre Pfister" initials="P.P." surname="Pfister">
<organization>Cisco</organization>
<address>
<postal>
<street></street>
<city></city>
<region></region>
<country>France</country>
</postal>
<phone></phone>
<email></email>
<uri></uri>
</address>

</author>

<author fullname="Jiazi Yi" initials="J.Y." surname="Yi">
<organization>LIX, Ecole Polytechnique</organization>
<address>
<postal>
<street></street>
<city></city>
<region></region>
<country>France</country>
</postal>
<phone></phone>
<email></email>
<uri></uri>
</address>

</author>

<date/>

<workgroup>Home Networking</workgroup>
<keyword></keyword>

<abstract>
<t>
This document reports experience with Distributed Node Consensus Protocol (DNCP). It includes an introduction of existed known implementations and simulation results of DNCP.
</t>
</abstract>

</front>

<middle>

<section title="Introduction" anchor="introduction">
	<t>
       <list style="symbols">
       		<t>
	DNCP is a protocol used for state synchronization. It is described in [draft-ietf-homenet-dncp-03], and right now its use case is mostly in homenet. DNCP provides a way for each node in the network to publish a set of TLV tuples, which is the data that it wants to share with other nodes, and valide the data received from other nodes by making sure the source node of the data is reachable. It takes advantage of trickle algorithm to control the sending of the status updates, thus decrease the amount of traffic especially when there are no updates in the network.
       		</t>
       		
       		<t>
	Since DNCP is a protocol not yet standardized, it has not been widely deployed, but in order for the homenet to run on it, it is important to evaluate its performances under various scenarios which is not so easy to do in real life but relatively easy using network simulators such as ns3. With the help of ns3, we can create various topologies and get logs for analyzing. This draft documents our experience of implementing dncp and integrating it in ns3, as well as the results of performance evaluation. We believe that the results obtained from the simulation are helpful for the implementation of dncp and can be a useful reference for the potential users of dncp.
       		</t>
       		
       		<t>
       	The document is organized as follows: First we introduce the current implementation of dncp in Section 2. Then the draft describes simulation setup, including simulation environment, the metrics being evaluated and the topologies used for simulation. The third part documents the results of performance evaluations under different scenarios. And finally from all the above, we draw our conclusions.
       		</t>
       </list>
	</t>
</section>
<section title="Implementations" anchor="implementation">
	<t>
		TODO list, for each known implementations (I think we have only one at this point?) 
		
       <list style="symbols">
       		<t>
       			conducted by who?
       		</t>
       		
       		<t>
       			open/close source? if open source, the link?
       		</t>
       		
       		<t>
       			if available, number of lines/foot print
       		</t>

			<t>
				if available, operational experience. 
			</t>
       </list>
	</t>
</section><section title="Simulation Setup" anchor="setup">
	<section title="Simulation Environment">
		<t>

	The current dncp implementation relies largely on linux library (for opening sockets, sending and receiving packets..etc) and uses uloop for scheduling events. To integrate dncp into ns3, we have to redefine all the functions in the code that are related to these two parts so that packets can be sent and received in ns3 and events can be scheduled using ns3 scheduler.
		</t>
		
		<t>
	We used CSMA model in ns3 to simulate layer one and layer two. CSMA model is designed in the spirit of Ethernet but different from the real-life Ethernet in the sense that the CSMA channel can provide instantaneous carrier sense and priority-based collision avoidance. The channel has three states: TRANSMITTING, PROPAGATING and IDLE, the states can be seen immediately by the devices attached to the channel so collision never happens. CSMA model consists of two parts: CSMA channel and CSMA device. CSMA channel is the model of the transmission medium, and CSMA device is like the an Ethernet device, the CSMA devices are connected to the channel. 
		</t>
		<t>
Listed below are several attributes of the CSMA device that we can configure: 

       		<list style="symbols">
       			<t>
MTU:The mac level maximum transmission unit, set to 1500
			</t>
       			<t>
Encapsulation Mode: Type of link layer encapsulation to use. In our simulation we use the default mode "Dix" which is commonly used in Ethernet.
			</t>
			<t>
TxQueue: Type of the transmit queue used by the device. In ns3, we have the possibility to choose from Codel queue, drop tail queue and RED (random early detection) queue. Here we use the drop tail queue and set the buffer of the queue to 100 packets. (bytes can also be used as the maximum queue size metrics)
			</t>
			<t>
Interframe gap: The pause between two frames
			</t>
		</list>
		</t>
		<t>
And the attributes of the CSMA channel that we can configure:
		</t>
       		<list style="symbols">
       			<t>
Data rate: The transmission data rate to be provided to the devices connected to the channel. That is the rate of the device pushing data into the channel. This attribute applies to all the devices on the same channel. In the simulation we set it to 1000Mbps thus providing an infinite throughput to eliminate the impact of throughput on the performance of dncp, in order to calculate the actual throughput comsumed. 
			</t>
			<t>
Delay: The spped-of-light propagation delay over the medium. Imagine there is a symmetrical hub that is of equal cable lenghth to all the devices of the channel. When one device sends a packet to another device, the packet fist reaches the hub and is forwarded to the destination device, so the propagation delay is always the same for a given channel. In our simulation, this delay is set to 1 micro second.
			</t>

		</list>

	</section>
	
	<section title="Performance metric">

	<list style="symbols">
		<t>
Convergence time: The time that dncp takes for the network to converge. 
		</t>
		
		<t>
Traffic consumption: The amount of traffic that dncp uses to converge. To evaluate the traffic consumption we count the overall amount of bytes sent during the converging process as well as the throughput per second.
		</t>.
	</list>	
	</section> 

	<section title="Chosen toplogies">
 
		<section title="Link topology">
			<t>
All the nodes are on the same link, share the medium.
			</t>
		</section>
		<section title="String topology">
			<t>
Nodes connected by point-to-point link in a line.
			</t>		
		</section>		
		<section title="Mesh topology">
			<t>
A fully connected mesh.
			</t>		
		</section>
		<section title="Tree topology">
			<t>
A binary tree
			</t>		
		</section>
		<section title="Double Tree topology">
			<t>
Add some redundancy on the top of binary tree topology
			</t>		
		</section>
	
	</section> 
</section>
<section title="Performance Evaluation" anchor="evaluation">
	
	<section title="Scenario 1: Link topology of different size">
		<texttable anchor='table' title="the average convergence time of link topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.843 s</c>
        	<c>3.092 s</c> 
        	<c>*4.432 s </c>
        	<c>5.143 s</c>
        	<c>6.535 s</c>
        	<c>*8.61 s</c>
		<c>11.57 s</c>
		<c>14.05 s</c>
        	<postamble>*: the average value is calculated over the results of 9 experiments because the other one diverges too much </postamble>
    		</texttable>
	</section>
	
	<section title="Scenario 2: String topology of different size">
		<texttable anchor='table2' title="the average convergence time of string topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.84 s</c>
        	<c>3.653 s</c> 
        	<c>5.244 s</c>
        	<c>7.099 s</c>
        	<c>8.786 s</c>
        	<c>11.111 s</c>
        	<c>12.869 s</c>
        	<c>15.032 s</c>
        	<postamble></postamble>
    		</texttable>
	</section>

	<section title="Scenario 3: Mesh topology of different size">
		<texttable anchor='table3' title="the average convergence time of mesh topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.71 s</c>
        	<c>3.205 s</c> 
        	<c>4.833 s</c>
        	<c>*6.19 s</c>
        	<c>10.638 s</c>
        	<c>13.018 s</c>
        	<c>15.334 s</c>
        	<c>17.931 s</c>
        	<postamble>*: the average value is calculated over the results of 9 experiments because the other one diverges too much </postamble>
    		</texttable>
	</section>

	<section title="Scenario 4: Tree topology of different size">
		<texttable anchor='table4' title="the average convergence time of tree topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.165</c>
        	<c>1.574 s</c> 
        	<c>1.861 s</c>
        	<c>1.997 s</c>
        	<c>2.33 s</c>
        	<c>2.42 s</c>
        	<c>2.561 s</c>
        	<c>2.597 s</c>
        	<postamble></postamble>
    		</texttable>
	</section>

	<section title="Scenario 5: Tree topology of different size">
		<texttable anchor='table5' title="the average convergence time of double topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.044 s</c>
        	<c>1.436 s</c> 
        	<c>1.5 s</c>
        	<c>1.704 s</c>
        	<c>1.96 s</c>
        	<c>1.98 s</c>
        	<c>2.06 s</c>
        	<c>2.086 s</c>
        	<postamble></postamble>
    		</texttable>
	</section>

</section>
<section title="Conclusion" anchor="conclusion">
	<t>
		conclusions
	</t>
</section>
</middle>

<back>


</back>
</rfc>
