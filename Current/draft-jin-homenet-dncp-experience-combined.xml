<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>

<rfc ipr="trust200902"
category="info"
docName="draft-jin-homenet-dncp-experience-00">

<front>
<title abbrev="DNCP Experience">Experience with the Distributed Node Consensus Protocol (DNCP)</title>

<author fullname="Kaiwen Jin" initials="K.J." surname="Jin">
<organization>Ecole Polytechnique / Cisco</organization>
<address>
<postal>
<street></street>
<city></city>
<region></region>
<country>France</country>
</postal>
<phone></phone>
<email></email>
<uri></uri>
</address>

</author>

<author fullname="Pierre Pfister" initials="P.P." surname="Pfister">
<organization>Cisco</organization>
<address>
<postal>
<street></street>
<city></city>
<region></region>
<country>France</country>
</postal>
<phone></phone>
<email></email>
<uri></uri>
</address>

</author>

<author fullname="Jiazi Yi" initials="J.Y." surname="Yi">
<organization>LIX, Ecole Polytechnique</organization>
<address>
<postal>
<street></street>
<city></city>
<region></region>
<country>France</country>
</postal>
<phone></phone>
<email></email>
<uri></uri>
</address>

</author>

<date/>

<workgroup>Home Networking</workgroup>
<keyword></keyword>

<abstract>
<t>
This document reports experience with Distributed Node Consensus Protocol (DNCP). It includes an introduction of existed known implementations and simulation results of DNCP.
</t>
</abstract>

</front>

<middle>

<section title="Introduction" anchor="introduction">

	<t>
			
	</t>
	
	<t>
       <list style="symbols">
       		<t>
	DNCP is a protocol used for state synchronization. It is described in [draft-ietf-homenet-dncp-03], and right now its use case is mostly in homenet. DNCP provides a way for each node in the network to publish a set of TLV tuples, which is the data that it wants to share with other nodes, and valide the data received from other nodes by making sure the source node of the data is reachable. It takes advantage of trickle algorithm to control the sending of the status updates, thus decrease the amount of traffic especially when there are no updates in the network.
       		</t>
       		
       		<t>
	Since DNCP is a protocol not yet standardized, it has not been widely deployed, but in order for the homenet to run on it, it is important to evaluate its performances under various scenarios which is not so easy to do in real life but relatively easy using network simulators such as ns3. With the help of ns3, we can create various topologies and get logs for analyzing. This draft documents our experience of implementing dncp and integrating it in ns3, as well as the results of performance evaluation. We believe that the results obtained from the simulation are helpful for the implementation of dncp and can be a useful reference for the potential users of dncp.
       		</t>
       		
       		<t>
       	The document is organized as follows: First we introduce the current implementation of dncp in Section 2. Then the draft describes simulation setup, including simulation environment, the metrics being evaluated and the topologies used for simulation. The third part documents the results of performance evaluations under different scenarios. And finally from all the above, we draw our conclusions.
       		</t>
       </list>
	</t>
</section>
<section title="Implementations" anchor="implementation">
	<t>
		
       <list style="symbols">
       		<t>
       			The implementation that we use in the simulation is condected by 
       		</t>
       		
       		<t>
       			This implementation is completely open sourse, ans is available at https://github.com/sbyx/hnetd/tree/libdncp
       		</t>
       		
       		<t>
       			if available, number of lines/foot print
       		</t>

			<t>
				if available, operational experience. 
			</t>
       </list>
	</t>
</section>
<section title="Simulation Setup" anchor="setup">
	<section title="Simulation Environment">
		<t>

	The current dncp implementation relies largely on linux library (for opening sockets, sending and receiving packets..etc) and uses libubox for scheduling events. To integrate dncp into ns3, we have to redefine all the functions in the code that are related to these two parts so that packets can be sent and received in ns3 and events can be scheduled using ns3 scheduler.
		</t>
		
		<t>
	We used CSMA model in ns3 to simulate layer one and layer two. CSMA model is designed in the spirit of Ethernet but different from the real-life Ethernet in the sense that the CSMA channel can provide instantaneous carrier sense and priority-based collision avoidance. The channel has three states: TRANSMITTING, PROPAGATING and IDLE, the states can be seen immediately by the devices attached to the channel so collision never happens. CSMA model consists of two parts: CSMA channel and CSMA device. CSMA channel is the model of the transmission medium, and CSMA device is like an Ethernet device, the CSMA devices are connected to the channel. 
		</t>
		<t>
Listed below are several attributes of the CSMA device that we can configure: 

       		<list style="symbols">
       			<t>
MTU:The mac level maximum transmission unit, set to 1500
			</t>
       			<t>
Encapsulation Mode: Type of link layer encapsulation to use. In our simulation we use the default mode "Dix" which is commonly used in Ethernet.
			</t>
			<t>
TxQueue: Type of the transmit queue used by the device. In ns3, we have the possibility to choose from Codel queue, drop tail queue and RED (random early detection) queue. Here we use the drop tail queue and set the buffer of the queue to 100 packets. (bytes can also be used as the maximum queue size metrics)
			</t>
			<t>
Interframe gap: The pause between two frames, in the simulation we just use 0.
			</t>
		</list>
		</t>
		<t>
And the attributes of the CSMA channel that we can configure:
		</t>
       		<list style="symbols">
       			<t>
Data rate: The transmission data rate to be provided to the devices connected to the channel. That is the rate of the device pushing data into the channel. This attribute applies to all the devices on the same channel. In the simulation we set it to 1000Mbps thus providing an infinite throughput to eliminate the impact of throughput on the performance of dncp, in order to calculate the actual throughput consumed. 
			</t>
			<t>
Delay: The speed-of-light propagation delay over the medium. Imagine there is a symmetrical hub that is of equal cable length to all the devices of the channel. When one device sends a packet to another device, the packet fist reaches the hub and is forwarded to the destination device, so the propagation delay is always the same for a given channel. In our simulation, this delay is set to 1 micro second.
			</t>

		</list>

	</section>
	
	<section title="Performance metric">

	<list style="symbols">
		<t>
Convergence time: The time that dncp takes for the network to converge. We use a concept of converging percentage to represent the converging state, basically the converging percentage is the proportion of the biggest cluster of nodes that share the same network hash. Apparently when this percentage is 100%, the network hqs coverged. 
		</t>
		
		<t>
Traffic consumption: The amount of traffic that dncp uses to converge. To evaluate the traffic consumption we count the overall amount of bytes sent during the converging process as well as the throughput per second.
		</t>.
	</list>	
	</section> 

	<section title="Chosen toplogies">
 
		<section title="Link topology">
			<t>
All the nodes are on the same link, share the medium:
			</t>

    	<figure anchor='figure_link'>
        <preamble></preamble>
        <artwork>
n1	n2	n3	n4
|	|	|	 |
---------------------------
            

        </artwork>
        <postamble>A simple example of link topology</postamble>
    </figure>


		</section>
		<section title="String topology">
			<t>
Nodes connected by point-to-point link in a line.
			</t>	
	
    	<figure anchor='figure_string'>
        <preamble></preamble>
        <artwork>

	---------	---------
	|	|	|	|
n1	n2	n3	n4	n5	n6
|	|	|	|	|	|
---------	---------	---------
            

        </artwork>
        <postamble>A simple example of String topology</postamble>
    </figure>
	
		</section>		
		<section title="Mesh topology">
			<t>
A fully connected mesh.
			</t>

	
		</section>
		<section title="Tree topology">
			<t>
A binary tree
			</t>

		</section>

		<section title="Double Tree topology">
			<t>
Add some redundancy on the top of binary tree topology
			</t>		
		</section>
	
	</section> 
</section>
<section title="Performance Evaluation" anchor="evaluation">
	<section title="Scenario 1: Link topology of different size">
 		<list style="symbols">
		<t>
Convergence time
		</t>
 		 </list>
		<texttable anchor='table' title="the average convergence time of link topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.84s</c>
        	<c>3.09s</c> 
        	<c>*4.43s </c>
        	<c>5.14s</c>
        	<c>6.53s</c>
        	<c>*8.61s</c>
		<c>11.57s</c>
		<c>14.05s</c>
        	<postamble>*: the average value is calculated over the results of 9 experiments because the other one diverges too much </postamble>
    		</texttable>

	<t>
	Note that we observed two accidents during the simulation. One happens in one experiment among the 10 that we ran for 30-node network, the network first converges at 4.016s, which is very close to the averge convergence time, but at 25.949s this converging state is broken and the network finally reconverges at 26.12s. The other one happens in the case of 60-node network where it fist converges at 7.081s then gets disturbed at 25.822s and comes back to converging at 26.303. As for the the reason of this happening, we will dig deeper into the logs and hope to find an explaination soon.
	</t>

 		<list style="symbols">
		<t>
Verbosity
		</t>
 		 </list>
		<texttable anchor='byte1' title="the traffic of dncp in link topology">
        	<preamble>The first row shows the overall bytes sent in the converging process, the second shows the bytes sent per node, calculated over 10 experiments</preamble>>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>85.3KB</c>
        	<c>604.7KB</c> 
        	<c>2.3MB</c>
        	<c>5.4MB</c>
        	<c>11.9MB</c>
        	<c>23.7MB</c>
        	<c>51.7MB</c>
        	<c>88.1MB</c>
        	<c>---</c>
        	<c>----</c> 
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>8.5KB</c>
        	<c>30.2KB</c> 
        	<c>79.6KB</c> 
        	<c>140.7KB</c>
        	<c>245.KB</c>
        	<c>404.8KB</c>
        	<c>757.2KB</c>
        	<c>1.1MB</c>
        	<postamble></postamble>
    		</texttable>
	</section>
	
	<section title="Scenario 2: String topology of different size">
 		<list style="symbols">
		<t>
Convergence time
		</t>
 		 </list>
		<texttable anchor='table2' title="the average convergence time of string topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.84s</c>
        	<c>3.65s</c> 
        	<c>5.24s</c>
        	<c>7.09s</c>
        	<c>8.79s</c>
        	<c>11.11s</c>
        	<c>12.87s</c>
        	<c>15.03s</c>
        	<postamble></postamble>
    		</texttable>

	<t>

If we plot the average convering time against the number of nodes, it is discernible that the graph is leaner. This result is exactly the same as we expected.
	</t>

 		<list style="symbols">
		<t>
Verbosity
		</t>
 		 </list>
		<texttable anchor='byte2' title="the traffic of dncp in string topology">
        	<preamble>The first row shows the overall bytes sent in the converging process, the second shows the bytes sent per node, calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>51.5KB</c>
        	<c>243.4KB</c> 
        	<c>605KB</c>
        	<c>1.2MB</c>
        	<c>2MB</c>
        	<c>3MB</c>
        	<c>4.1MB</c>
        	<c>5.6MB</c>
        	<c>---</c>
        	<c>----</c> 
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>5.1KB</c>
        	<c>12.2KB</c> 
        	<c>20.1KB</c> 
        	<c>30.9KB</c>
        	<c>40.5KB</c>
        	<c>50.4KB</c>
        	<c>59.2KB</c>
        	<c>70.1KB</c>
        	<postamble></postamble>
    		</texttable>
	</section>
 		<list style="symbols">
		<t>
Convergence time
		</t>
 		 </list>
	<section title="Scenario 3: Mesh topology of different size">
		<texttable anchor='table3' title="the average convergence time of mesh topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.71s</c>
        	<c>3.2s</c> 
        	<c>4.83s</c>
        	<c>*6.19s</c>
        	<c>10.64s</c>
        	<c>13.02s</c>
        	<c>15.33s</c>
        	<c>17.93s</c>
        	<postamble>*: the average value is calculated over the results of 9 experiments because the other one diverges too much </postamble>
    		</texttable>
 		<list style="symbols">
		<t>
Verbosity
		</t>
 		 </list>
		<texttable anchor='byte3' title="the traffic of dncp in mesh topology">
        	<preamble>The first row shows the overall bytes sent in the converging process, the second shows the bytes sent per node, calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>202.7KB</c>
        	<c>1.6MB</c> 
        	<c>6.6MB</c>
        	<c>18.1MB</c>
        	<c>49.1MB</c>
        	<c>95.8MB</c>
        	<c>167.4MB</c>
        	<c>271.9MB</c>
        	<c>---</c>
        	<c>----</c> 
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>20.3KB</c>
        	<c>83.5KB</c> 
        	<c>222.1KB</c> 
        	<c>453.8KB</c>
        	<c>983.1KB</c>
        	<c>1.6MB</c>
        	<c>2.4MB</c>
        	<c>3.4MB</c>
        	<postamble></postamble>
    		</texttable>
	</section>
 		<list style="symbols">
		<t>
Convergence time
		</t>
 		 </list>
	<section title="Scenario 4: Tree topology of different size">
		<texttable anchor='table4' title="the average convergence time of tree topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.16s</c>
        	<c>1.57s</c> 
        	<c>1.86s</c>
        	<c>2s</c>
        	<c>2.33s</c>
        	<c>2.42s</c>
        	<c>2.56s</c>
        	<c>2.6s</c>
        	<postamble></postamble>
    		</texttable>

 		<list style="symbols">
		<t>
Verbosity
		</t>
 		 </list>

<texttable anchor='byte4' title="the traffic of dncp in tree topology">
        	<preamble>The first row shows the overall bytes sent in the converging process, the second shows the bytes sent per node, calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>
        	<c>40.7KB</c>
        	<c>166.7KB</c> 
        	<c>374KB</c>
        	<c>644.5KB</c>
        	<c>1MB</c>
        	<c>1.3MB</c>
        	<c>1.9MB</c>
        	<c>2.4MB</c>
        	<c>---</c>
        	<c>----</c> 
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>4.1KB</c>
        	<c>8.3KB</c> 
        	<c>12.4KB</c> 
        	<c>16.1KB</c>
        	<c>20.2KB</c>
        	<c>22.8KB</c>
        	<c>26.7KB</c>
        	<c>29.9KB</c>
        	<postamble></postamble>
    		</texttable>
	</section>

	<section title="Scenario 5: Tree topology of different size">

 		<list style="symbols">
		<t>
Convergence time
		</t>
 		 </list>
		<texttable anchor='table5' title="the average convergence time of double tree topology">
        	<preamble>The average value is calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>1.04s</c>
        	<c>1.44s</c> 
        	<c>1.5s</c>
        	<c>1.7s</c>
        	<c>1.96s</c>
        	<c>1.98s</c>
        	<c>2.06s</c>
        	<c>2.09s</c>
        	<postamble></postamble>
    		</texttable>

 		<list style="symbols">
		<t>
Verbosity
		</t>
 		 </list>

<texttable anchor='byte5' title="the traffic of dncp in tree topology">
        	<preamble>The first row shows the overall bytes sent in the converging process, the second shows the bytes sent per node, calculated over 10 experiments</preamble>
        	<ttcol align='center'>10 nodes</ttcol>
        	<ttcol align='center'>20 nodes</ttcol>
        	<ttcol align='center'>30 nodes</ttcol>
        	<ttcol align='center'>40 nodes</ttcol>
        	<ttcol align='center'>50 nodes</ttcol>
        	<ttcol align='center'>60 nodes</ttcol>
        	<ttcol align='center'>70 nodes</ttcol>
        	<ttcol align='center'>80 nodes</ttcol>

        	<c>66.9KB</c>
        	<c>265KB</c> 
        	<c>605.1KB</c>
        	<c>1MB</c>
        	<c>1.5MB</c>
        	<c>2MB</c>
        	<c>2.8MB</c>
        	<c>3.5MB</c>
        	<c>---</c>
        	<c>----</c> 
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>----</c>
        	<c>6.7KB</c>
        	<c>13.2KB</c> 
        	<c>20.2KB</c> 
        	<c>25.3KB</c>
        	<c>30.8KB</c>
        	<c>33.2KB</c>
        	<c>39.7KB</c>
        	<c>44.7KB</c>
        	<postamble></postamble>
    		</texttable>
	</section>

</section>
<section title="Conclusion" anchor="conclusion">
	<t>
		conclusions
	</t>
</section>
</middle>

<back>


</back>
</rfc>
